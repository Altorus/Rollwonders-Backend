const e=document.querySelector(".__inset"),t=document.querySelector("body");function closeAllMenus(){document.querySelectorAll(".popup").forEach((t=>{t.classList.remove("show"),e.classList.remove("show")})),t.style.overflow="auto"}async function sendData(e,t){const n=document.querySelector("[name=csrfmiddlewaretoken]").value,o=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":n},body:JSON.stringify(e)});if(o.ok)return o.json();throw new Error(o.statusText)}function getSelectedIngredients(){const e=document.querySelectorAll(".ingridient-card input[type=checkbox]:checked");return e.length?Array.from(e).map((e=>e.value)):[]}function updatePercentage(e){const t=document.querySelector(".__makingPercent");if(e>=0&&e<=100?t.textContent=`${e}%`:console.error("Значение должно быть в диапазоне от 0 до 100"),100==e){const e=new URL(window.location.href),t=new URLSearchParams(e.search).get("recipe_id");window.location.href=`/recipe/${t}`}}e.addEventListener("click",(()=>{closeAllMenus()})),function init(){(function recipeProcessor(){const e=document.querySelectorAll(".ingridient-card"),t=document.querySelector(".__createRecipe");e.length&&t&&(e.forEach((e=>{e.querySelectorAll("input[type=checkbox]").forEach((e=>{e.addEventListener("change",(e=>{!function changeIngredientState(e){const t=e.querySelector(".__ingridientState"),n=e.querySelectorAll("input[type=checkbox]:checked");if(n.length>0){const e=Array.from(n).map((e=>e.previousElementSibling.innerText));t.innerText=e.join(", ")}else t.innerText="Не выбрано"}(e.target.closest(".ingridient-card")),function changeCreateButtonState(){const e=document.querySelectorAll(".ingridient-card"),t=Array.from(e).some((e=>e.querySelector("input[type=checkbox]:checked")));document.querySelector(".__createRecipe").disabled=!t}()}))}))})),t.addEventListener("click",(e=>{sendData({ingredients:getSelectedIngredients()},"/api/generate-recipe/").then((e=>{window.location.href="/making-recipe/?recipe_id="+e.recipe_id}))})))})(),function makingRecipeFunctions(){if(document.querySelector(".__makingPercent")){let e=0;const t=setInterval((async()=>{if(e>=100)clearInterval(t);else if(e++,updatePercentage(e),e%30==0)try{const n=new URL(window.location.href),o=new URLSearchParams(n.search).get("recipe_id"),c=await fetch(`/api/generate-recipe/${o}/`);if((await c.json()).recipeCreated)e=100,updatePercentage(e),clearInterval(t);else if(e>=90){clearInterval(t);const n=setInterval((()=>{e++,updatePercentage(e),e>=100&&clearInterval(n)}),600)}}catch(n){console.error("Ошибка запроса:",n)}}),100);setInterval((()=>{}),1e3)}}()}(),function preloader(){window.addEventListener("load",(function(){document.querySelector("#preloader").style.display="none"}))}(),async function authentication(){const e=window.Telegram.WebApp;if(!(await async function getAuthoriseStatus(){return(await async function getData(e){const t=await fetch(e,{method:"GET"});if(t.ok)return t.json();throw new Error(t.statusText)}("/api/authentication/get-status/")).status}())){const t=e.initDataUnsafe.user;if(t){let e;e=t.username?t.username:t.id,function authoriseUser(e){sendData(e,"/api/authentication/login/").then((e=>{console.log(e)})).catch((t=>{!function registerUser(e){sendData(e,"/api/authentication/register/").then((e=>{console.log(e)}))}(e)}))}({username:e,telegram_id:t.id})}}}(),function popup(){const n=document.querySelectorAll(".__openPopup");n.length>0&&n.forEach((n=>{n.addEventListener("click",(o=>{!function openPopup(n){const o=document.querySelector(`[data-popuptype="${n}"]`);o&&(o.classList.add("show"),e.classList.add("show"),t.style.overflow="hidden")}(n.dataset.popuptype)}))}));const o=document.querySelectorAll(".cta-button-mobile");o.length>0&&o.forEach((e=>{let t=0;const n=e.closest(".popup");let o=0;e.addEventListener("touchstart",(e=>{const c=e.touches[0].clientY;t=c,o=n.style.top})),e.addEventListener("touchmove",(e=>{const o=e.touches[0].clientY;t<o&&(n.style.top="auto",n.style.bottom=window.innerHeight-o-n.offsetHeight+"px")})),e.addEventListener("touchend",(e=>{const c=e.changedTouches[0].clientY;t<c+100?(closeAllMenus(),n.style.top=null,n.style.bottom=null):(n.style.top=o,n.style.bottom=null)}))}))}(),function accordion(){const e=document.querySelectorAll(".accordion-item");e&&e.forEach((t=>{t.addEventListener("click",(()=>{const n=t.querySelector(".accordion-item__body");let o=!1;e.forEach((e=>{if(e!==t&&e.classList.contains("show")){const t=e.querySelector(".accordion-item__body");e.classList.remove("show"),t.style.maxHeight=null,o=!0}})),t.classList.contains("show")&&!o?(t.classList.remove("show"),n.style.maxHeight=null):t.classList.contains("show")||(t.classList.add("show"),n.style.maxHeight=2*n.scrollHeight+"px")}))}))}(),function themeManager(){const e=document.querySelector("body"),t=window.Telegram.WebApp.colorScheme;"true"===localStorage.getItem("switchedTheme")?e.classList.add("dark-theme"):localStorage.getItem("switchedTheme")||"light"===t?e.classList.remove("dark-theme"):e.classList.add("dark-theme");const n=document.querySelector(".__changeTheme");n&&n.addEventListener("click",(t=>{e.classList.contains("dark-theme")?localStorage.removeItem("switchedTheme"):localStorage.setItem("switchedTheme","true"),e.classList.toggle("dark-theme")}))}(),function shareMenu(){const e=document.querySelector(".__openShareMenu");e&&e.addEventListener("click",(e=>{const t=document.querySelector(".__recipeName").innerText;navigator.share&&navigator.share({title:t,text:"Сочные рецепты в сервисе Rollwonders",url:window.location.href}).then((()=>console.log("Successful share"))).catch((e=>console.log("Error sharing:",e)))}))}();
//# sourceMappingURL=main.min.js.map
